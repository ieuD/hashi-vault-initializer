---
# Playbook for audit configuration only
- name: Configure Vault Audit Logging
  hosts: vault_servers
  gather_facts: yes
  become: no
  vars:
    ansible_python_interpreter: "{{ ansible_playbook_python }}"

  pre_tasks:
    - name: Check for root token
      fail:
        msg: "Root token is required. Set vault_root_token variable or ensure vault-init has been run."
      when: vault_root_token is not defined or vault_root_token == ""

  roles:
    - role: vault-audit

  post_tasks:
    - name: Display audit configuration summary
      debug:
        msg: |
          Vault Audit Configuration Complete!

          Audit Devices: {{ vault_audit_devices | map(attribute='path') | list }}
          Log Directory: {{ vault_audit_log_dir }}

          You can view audit logs at the configured paths.
